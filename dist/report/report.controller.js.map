{"version":3,"sources":["../../src/report/report.controller.js"],"names":["router","post","req","res","query","body","assigneeString","getAssigneeString","assignee","assigneeArray","split","get","url","length","method","headers","token","then","data","results","composeTaskResult","send","catch","issues","each","result","push","task_id","key","task_type","task_description","task_creation_date","task_updated_date","task_assignee","task_project","task_status","getStatus","sortBy"],"mappings":";;;;;;AAAA;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,SAAS,sBAAf;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA;;;;;;;;;;;;;;;;;;;;;AAqBAA,OAAOC,IAAP,CAAY,GAAZ,EAAiB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC9B,MAAIC,QAAQF,IAAIG,IAAhB;AACA,MAAIC,iBAAiB,iBAAcC,iBAAd,CAAgCH,MAAMI,QAAtC,CAArB;AACA,MAAIC,gBAAgBL,MAAMI,QAAN,CAAeE,KAAf,CAAqB,GAArB,CAApB;AACA,kBAAMC,GAAN,CAAUP,MAAMQ,GAAN,GAAY,8BAAZ,GAA6CN,cAA7C,GAA8D,cAA9D,GAA+E,MAAMG,cAAcI,MAA7G,EACC;AACCC,YAAQ,KADT;AAECC,aAAS,EAAE,iBAAiB,WAAWX,MAAMY,KAApC;AAFV,GADD,EAKEC,IALF,CAKO,UAACC,IAAD,EAAU;AAChB,QAAIC,UAAUC,kBAAkB,iBAAET,GAAF,CAAMO,IAAN,EAAY,aAAZ,CAAlB,EAA8Cd,KAA9C,CAAd;AACAD,QAAIkB,IAAJ,CAAS,EAAE,UAAUF,OAAZ,EAAT;AACA,GARD,EASEG,KATF,CASQ,UAACJ,IAAD,EAAU;AAChBf,QAAIkB,IAAJ,CAAS,EAAE,SAAS,0BAA0BH,IAArC,EAAT;AACA,GAXF;AAYA,CAhBD;;AAkBA,IAAME,oBAAoB,SAApBA,iBAAoB,CAACD,OAAD,EAAUf,KAAV,EAAoB;AAC7C,MAAImB,SAAS,EAAb;AACA,mBAAEC,IAAF,CAAOL,OAAP,EAAgB,UAACM,MAAD,EAAY;AAC3B,QAAI,iBAAEd,GAAF,CAAMc,MAAN,EAAc,oBAAd,MAAwC,SAA5C,EAAuD;AACtDF,aAAOG,IAAP,CAAY;AACXC,iBAASF,OAAOG,GADL;AAEXC,mBAAW,iBAAElB,GAAF,CAAMc,MAAN,EAAc,uBAAd,CAFA;AAGXK,0BAAkB,iBAAEnB,GAAF,CAAMc,MAAN,EAAc,gBAAd,CAHP;AAIXM,4BAAoB,iBAAEpB,GAAF,CAAMc,MAAN,EAAc,gBAAd,CAJT;AAKXO,2BAAmB,iBAAErB,GAAF,CAAMc,MAAN,EAAc,gBAAd,CALR;AAMXQ,uBAAe,iBAAEtB,GAAF,CAAMc,MAAN,EAAc,6BAAd,CANJ;AAOXS,sBAAc,iBAAEvB,GAAF,CAAMc,MAAN,EAAc,oBAAd,CAPH;AAQXU,qBAAa,iBAAcC,SAAd,CAAwB,iBAAEzB,GAAF,CAAMc,MAAN,EAAc,oBAAd,CAAxB,EAA6DrB,KAA7D;AARF,OAAZ;AAUA;AACD,GAbD,EAaGA,KAbH;AAcA,SAAO,iBAAEiC,MAAF,CAASd,MAAT,EAAiB,CAAC,aAAD,EAAgB,SAAhB,CAAjB,CAAP;AACA,CAjBD;;kBAoBevB,M","file":"report.controller.js","sourcesContent":["import { Router } from 'express';\nimport axios from 'axios';\nimport _ from 'lodash';\nimport reportService from './report.service';\n\nconst router = Router();\n/**\n * @swagger\n * definitions:\n *   Report:\n *     properties:\n *       from:\n *         type: string\n *       to:\n *         type: string\n *       url:\n *         type: string\n *       title:\n *         type: string\n *       assignee:\n *         type: string\n *       status:\n *         type: string\n *       token:\n *         type: string\n *       todo:\n *         type: string\n *       inprogress:\n *         type: string\n *       completed:\n *         type: string\n */\n\n/**\n * @swagger\n * /api/report:\n *   post:\n *     tags:\n *       - Report Generator\n *     description: Lists Jira Issues with status\n *     produces:\n *       - application/json\n *     parameters:\n *       - name: payload\n *         description: Jira Issues\n *         in: body\n *         required: true\n *         schema:\n *           $ref: '#/definitions/Report'\n *     responses:\n *       200:\n *         description: Successfully Listed\n */\n\nrouter.post('/', (req, res) => {\n\tlet query = req.body;\n\tlet assigneeString = reportService.getAssigneeString(query.assignee);\n\tlet assigneeArray = query.assignee.split(',');\n\taxios.get(query.url + '/rest/api/latest/search?jql=' + assigneeString + '&maxResults=' + 100 * assigneeArray.length,\n\t\t{\n\t\t\tmethod: 'GET',\n\t\t\theaders: { 'Authorization': 'Basic ' + query.token }\n\t\t}\n\t).then((data) => {\n\t\tlet results = composeTaskResult(_.get(data, 'data.issues'), query);\n\t\tres.send({ 'result': results });\n\t})\n\t\t.catch((data) => {\n\t\t\tres.send({ 'error': 'Unable to fetch data!' + data });\n\t\t});\n});\n\nconst composeTaskResult = (results, query) => {\n\tlet issues = [];\n\t_.each(results, (result) => {\n\t\tif (_.get(result, 'fields.status.name') !== 'Backlog') {\n\t\t\tissues.push({\n\t\t\t\ttask_id: result.key,\n\t\t\t\ttask_type: _.get(result, 'fields.issuetype.name'),\n\t\t\t\ttask_description: _.get(result, 'fields.summary'),\n\t\t\t\ttask_creation_date: _.get(result, 'fields.created'),\n\t\t\t\ttask_updated_date: _.get(result, 'fields.updated'),\n\t\t\t\ttask_assignee: _.get(result, 'fields.assignee.displayName'),\n\t\t\t\ttask_project: _.get(result, 'fields.project.key'),\n\t\t\t\ttask_status: reportService.getStatus(_.get(result, 'fields.status.name'), query)\n\t\t\t});\n\t\t}\n\t}, query);\n\treturn _.sortBy(issues, ['task_status', 'task_id']);\n};\n\n\nexport default router;"]}