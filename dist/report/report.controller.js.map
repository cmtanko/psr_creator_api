{"version":3,"sources":["../../src/report/report.controller.js"],"names":["router","getStatus","statusCode","query","console","log","toLowerCase","inprogress","completed","todo","post","req","res","next","body","assigneeString","assigneeArray","assignee","split","forEach","a","i","array","length","get","url","method","headers","token","then","data","results","issues","each","result","push","task_id","key","task_type","task_description","task_creation_date","task_updated_date","task_assignee","task_project","task_status","sortBy","send","catch"],"mappings":";;;;;;AAAA;;AACA;;;;AACA;;;;;;AAEA,IAAMA,SAAS,sBAAf;AACA,IAAMC,YAAY,SAAZA,SAAY,CAACC,UAAD,EAAaC,KAAb,EAAuB;AACvCC,UAAQC,GAAR,CAAYH,aAAa,KAAb,GAAqBC,KAAjC;AACA,MAAID,WAAWI,WAAX,OAA6BH,MAAMI,UAAN,CAAiBD,WAAjB,EAAjC,EAAiE;AAAE,WAAO,aAAP;AAAuB,GAA1F,MACK,IAAIJ,WAAWI,WAAX,OAA6BH,MAAMK,SAAN,CAAgBF,WAAhB,EAAjC,EAAgE;AAAE,WAAO,WAAP;AAAqB,GAAvF,MACA,IAAIJ,WAAWI,WAAX,OAA6BH,MAAMM,IAAN,CAAWH,WAAX,EAAjC,EAA2D;AAAE,WAAO,OAAP;AAAiB;AACnF,SAAOJ,UAAP;AACD,CAND;;AAQAF,OAAOU,IAAP,CAAY,GAAZ,EAAiB,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACnC,MAAIV,QAAQQ,IAAIG,IAAhB;AACA,MAAIC,iBAAiB,EAArB;AACA,MAAIC,gBAAgBb,MAAMc,QAAN,CAAeC,KAAf,CAAqB,GAArB,CAApB;AACAF,gBAAcG,OAAd,CAAsB,UAAUC,CAAV,EAAaC,CAAb,EAAgBC,KAAhB,EAAuB;AAC3C,QAAID,MAAMC,MAAMC,MAAN,GAAe,CAAzB,EAA4B;AAC1BR,wBAAkB,cAAcK,CAAhC;AACD,KAFD,MAEO;AACLL,wBAAkB,cAAcK,CAAd,GAAkB,IAApC;AACD;AACF,GAND,EAMGL,cANH;AAOAX,UAAQC,GAAR,CAAYU,cAAZ;AACA,kBAAMS,GAAN,CAAUrB,MAAMsB,GAAN,GAAY,8BAAZ,GAA6CV,cAA7C,GAA8D,cAA9D,GAA+E,MAAMC,cAAcO,MAA7G,EACE;AACEG,YAAQ,KADV;AAEEC,aAAS,EAAE,iBAAiB,WAAWxB,MAAMyB,KAApC;AAFX,GADF,EAKEC,IALF,CAKO,UAACC,IAAD,EAAU;AACf,QAAIC,UAAUD,KAAKA,IAAL,CAAUE,MAAxB;AACA,QAAIA,SAAS,EAAb;AACA,qBAAEC,IAAF,CAAOF,OAAP,EAAgB,UAACG,MAAD,EAAY;AAC1B,UAAI,iBAAEV,GAAF,CAAMU,MAAN,EAAc,oBAAd,MAAwC,SAA5C,EAAuD;AACrDF,eAAOG,IAAP,CAAY;AACVC,mBAASF,OAAOG,GADN;AAEVC,qBAAW,iBAAEd,GAAF,CAAMU,MAAN,EAAc,uBAAd,CAFD;AAGVK,4BAAkB,iBAAEf,GAAF,CAAMU,MAAN,EAAc,gBAAd,CAHR;AAIVM,8BAAoB,iBAAEhB,GAAF,CAAMU,MAAN,EAAc,gBAAd,CAJV;AAKVO,6BAAmB,iBAAEjB,GAAF,CAAMU,MAAN,EAAc,gBAAd,CALT;AAMVQ,yBAAe,iBAAElB,GAAF,CAAMU,MAAN,EAAc,6BAAd,CANL;AAOVS,wBAAc,iBAAEnB,GAAF,CAAMU,MAAN,EAAc,oBAAd,CAPJ;AAQVU,uBAAa3C,UAAU,iBAAEuB,GAAF,CAAMU,MAAN,EAAc,oBAAd,CAAV,EAA+C/B,KAA/C;AARH,SAAZ;AAUD;AACF,KAbD,EAaGA,KAbH;AAcA4B,cAAU,iBAAEc,MAAF,CAASb,MAAT,EAAiB,CAAC,aAAD,EAAgB,SAAhB,CAAjB,CAAV;AACApB,QAAIkC,IAAJ,CAAS,EAAE,UAAUf,OAAZ,EAAT;AACD,GAxBD,EAyBGgB,KAzBH,CAyBS,UAACjB,IAAD,EAAU;AACflB,QAAIkC,IAAJ,CAAS,EAAE,SAAS,0BAA0BhB,IAArC,EAAT;AACD,GA3BH;AA4BD,CAxCD;;kBA0Ce9B,M","file":"report.controller.js","sourcesContent":["import { Router } from 'express';\nimport axios from 'axios';\nimport _ from 'lodash';\n\nconst router = Router();\nconst getStatus = (statusCode, query) => {\n  console.log(statusCode + '---' + query);\n  if (statusCode.toLowerCase() === query.inprogress.toLowerCase()) { return 'In Progress'; }\n  else if (statusCode.toLowerCase() === query.completed.toLowerCase()) { return 'Completed'; }\n  else if (statusCode.toLowerCase() === query.todo.toLowerCase()) { return 'To Do'; }\n  return statusCode;\n};\n\nrouter.post('/', (req, res, next) => {\n  let query = req.body;\n  let assigneeString = \"\";\n  let assigneeArray = query.assignee.split(',');\n  assigneeArray.forEach(function (a, i, array) {\n    if (i === array.length - 1) {\n      assigneeString += 'assignee=' + a;\n    } else {\n      assigneeString += 'assignee=' + a + '||';\n    }\n  }, assigneeString);\n  console.log(assigneeString);\n  axios.get(query.url + '/rest/api/latest/search?jql=' + assigneeString + '&maxResults=' + 100 * assigneeArray.length,\n    {\n      method: 'GET',\n      headers: { 'Authorization': 'Basic ' + query.token }\n    }\n  ).then((data) => {\n    let results = data.data.issues;\n    let issues = [];\n    _.each(results, (result) => {\n      if (_.get(result, 'fields.status.name') !== 'Backlog') {\n        issues.push({\n          task_id: result.key,\n          task_type: _.get(result, 'fields.issuetype.name'),\n          task_description: _.get(result, 'fields.summary'),\n          task_creation_date: _.get(result, 'fields.created'),\n          task_updated_date: _.get(result, 'fields.updated'),\n          task_assignee: _.get(result, 'fields.assignee.displayName'),\n          task_project: _.get(result, 'fields.project.key'),\n          task_status: getStatus(_.get(result, 'fields.status.name'), query)\n        });\n      }\n    }, query);\n    results = _.sortBy(issues, ['task_status', 'task_id']);\n    res.send({ 'result': results });\n  })\n    .catch((data) => {\n      res.send({ 'error': 'Unable to fetch data!' + data });\n    });\n});\n\nexport default router;"]}