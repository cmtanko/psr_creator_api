{"version":3,"sources":["../../src/report/report.controller.js"],"names":["router","post","req","res","next","query","body","assigneeString","getAssigneeString","assignee","assigneeArray","split","get","url","length","method","headers","token","then","data","results","composeTaskResult","send","catch","getStatus","statusCode","toLowerCase","inprogress","completed","todo","forEach","a","i","array","issues","each","result","push","task_id","key","task_type","task_description","task_creation_date","task_updated_date","task_assignee","task_project","task_status","sortBy"],"mappings":"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","file":"report.controller.js","sourcesContent":["import { Router } from 'express';\nimport axios from 'axios';\nimport _ from 'lodash';\n\nconst router = Router();\n/**\n * @swagger\n * definitions:\n *   Report:\n *     properties:\n *       from:\n *         type: string\n *       to:\n *         type: string\n *       url:\n *         type: string\n *       title:\n *         type: string\n *       assignee:\n *         type: string\n *       status:\n *         type: string\n *       token:\n *         type: string\n *       todo:\n *         type: string\n *       inprogress:\n *         type: string\n *       completed:\n *         type: string\n */\n\n/**\n * @swagger\n * /api/report:\n *   post:\n *     tags:\n *       - Report Generator\n *     description: Lists Jira Issues with status\n *     produces:\n *       - application/json\n *     parameters:\n *       - name: payload\n *         description: Jira Issues\n *         in: body\n *         required: true\n *         schema:\n *           $ref: '#/definitions/Report'\n *     responses:\n *       200:\n *         description: Successfully Listed\n */\n\nrouter.post('/', (req, res, next) => {\n  let query = req.body;\n  let assigneeString = getAssigneeString(query.assignee);\n  let assigneeArray = query.assignee.split(',');\n  axios.get(query.url + '/rest/api/latest/search?jql=' + assigneeString + '&maxResults=' + 100 * assigneeArray.length,\n    {\n      method: 'GET',\n      headers: { 'Authorization': 'Basic ' + query.token }\n    }\n  ).then((data) => {\n    let results = composeTaskResult(_.get(data, 'data.issues'), query);\n    res.send({ 'result': results });\n  })\n    .catch((data) => {\n      res.send({ 'error': 'Unable to fetch data!' + data });\n    });\n});\n\nconst getStatus = (statusCode, query) => {\n  if (statusCode.toLowerCase() === query.inprogress.toLowerCase()) { return 'In Progress'; }\n  else if (statusCode.toLowerCase() === query.completed.toLowerCase()) { return 'Completed'; }\n  else if (statusCode.toLowerCase() === query.todo.toLowerCase()) { return 'To Do'; }\n  return statusCode;\n};\n\nconst getAssigneeString = (assignee) => {\n  //CONCATENATE ALL ASSIGNEES IF MORE THAN ONE WITH CORRECT FORMAT\n  let assigneeString = \"\";\n  let assigneeArray = assignee.split(',');\n  assigneeArray.forEach(function (a, i, array) {\n    if (i === array.length - 1) {\n      assigneeString += 'assignee=' + a;\n    } else {\n      assigneeString += 'assignee=' + a + '||';\n    }\n  }, assigneeString);\n  return assigneeString;\n}\n\nconst composeTaskResult = (results, query) => {\n  let issues = [];\n  _.each(results, (result) => {\n    if (_.get(result, 'fields.status.name') !== 'Backlog') {\n      issues.push({\n        task_id: result.key,\n        task_type: _.get(result, 'fields.issuetype.name'),\n        task_description: _.get(result, 'fields.summary'),\n        task_creation_date: _.get(result, 'fields.created'),\n        task_updated_date: _.get(result, 'fields.updated'),\n        task_assignee: _.get(result, 'fields.assignee.displayName'),\n        task_project: _.get(result, 'fields.project.key'),\n        task_status: getStatus(_.get(result, 'fields.status.name'), query)\n      });\n    }\n  }, query);\n  return _.sortBy(issues, ['task_status', 'task_id']);\n}\n\n\nexport default router;"]}