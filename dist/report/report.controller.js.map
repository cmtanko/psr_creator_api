{"version":3,"sources":["../../src/report/report.controller.js"],"names":["router","post","req","res","query","body","assigneeString","getAssigneeString","assignee","assigneeArray","split","get","url","length","method","headers","token","then","data","results","composeTaskResult","send","catch","getStatus","statusCode","toLowerCase","inprogress","completed","todo","forEach","a","i","array","issues","each","result","push","task_id","key","task_type","task_description","task_creation_date","task_updated_date","task_assignee","task_project","task_status","sortBy"],"mappings":"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","file":"report.controller.js","sourcesContent":["import { Router } from 'express';\nimport axios from 'axios';\nimport _ from 'lodash';\n\nconst router = Router();\n/**\n * @swagger\n * definitions:\n *   Report:\n *     properties:\n *       from:\n *         type: string\n *       to:\n *         type: string\n *       url:\n *         type: string\n *       title:\n *         type: string\n *       assignee:\n *         type: string\n *       status:\n *         type: string\n *       token:\n *         type: string\n *       todo:\n *         type: string\n *       inprogress:\n *         type: string\n *       completed:\n *         type: string\n */\n\n/**\n * @swagger\n * /api/report:\n *   post:\n *     tags:\n *       - Report Generator\n *     description: Lists Jira Issues with status\n *     produces:\n *       - application/json\n *     parameters:\n *       - name: payload\n *         description: Jira Issues\n *         in: body\n *         required: true\n *         schema:\n *           $ref: '#/definitions/Report'\n *     responses:\n *       200:\n *         description: Successfully Listed\n */\n\nrouter.post('/', (req, res) => {\n\tlet query = req.body;\n\tlet assigneeString = getAssigneeString(query.assignee);\n\tlet assigneeArray = query.assignee.split(',');\n\taxios.get(query.url + '/rest/api/latest/search?jql=' + assigneeString + '&maxResults=' + 100 * assigneeArray.length,\n\t\t{\n\t\t\tmethod: 'GET',\n\t\t\theaders: { 'Authorization': 'Basic ' + query.token }\n\t\t}\n\t).then((data) => {\n\t\tlet results = composeTaskResult(_.get(data, 'data.issues'), query);\n\t\tres.send({ 'result': results });\n\t})\n\t\t.catch((data) => {\n\t\t\tres.send({ 'error': 'Unable to fetch data!' + data });\n\t\t});\n});\n\nconst getStatus = (statusCode, query) => {\n\tif (statusCode.toLowerCase() === query.inprogress.toLowerCase()) { return 'In Progress'; } else if (statusCode.toLowerCase() === query.completed.toLowerCase()) { return 'Completed'; } else if (statusCode.toLowerCase() === query.todo.toLowerCase()) { return 'To Do'; }\n\treturn statusCode;\n};\n\nconst getAssigneeString = (assignee) => {\n\t//CONCATENATE ALL ASSIGNEES IF MORE THAN ONE WITH CORRECT FORMAT\n\tlet assigneeString = \"\";\n\tlet assigneeArray = assignee.split(',');\n\tassigneeArray.forEach((a, i, array) => {\n\t\tif (i === array.length - 1) {\n\t\t\tassigneeString += 'assignee=' + a;\n\t\t} else {\n\t\t\tassigneeString += 'assignee=' + a + '||';\n\t\t}\n\t}, assigneeString);\n\treturn assigneeString;\n};\n\nconst composeTaskResult = (results, query) => {\n\tlet issues = [];\n\t_.each(results, (result) => {\n\t\tif (_.get(result, 'fields.status.name') !== 'Backlog') {\n\t\t\tissues.push({\n\t\t\t\ttask_id: result.key,\n\t\t\t\ttask_type: _.get(result, 'fields.issuetype.name'),\n\t\t\t\ttask_description: _.get(result, 'fields.summary'),\n\t\t\t\ttask_creation_date: _.get(result, 'fields.created'),\n\t\t\t\ttask_updated_date: _.get(result, 'fields.updated'),\n\t\t\t\ttask_assignee: _.get(result, 'fields.assignee.displayName'),\n\t\t\t\ttask_project: _.get(result, 'fields.project.key'),\n\t\t\t\ttask_status: getStatus(_.get(result, 'fields.status.name'), query)\n\t\t\t});\n\t\t}\n\t}, query);\n\treturn _.sortBy(issues, ['task_status', 'task_id']);\n};\n\n\nexport default router;"]}