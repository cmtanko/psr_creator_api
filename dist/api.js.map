{"version":3,"sources":["../src/api.js"],"names":["app","APP_PORT","process","env","PORT","APP_HOST","use","json","static","join","__dirname","get","req","res","setHeader","send","config","email","password","email_to","gToken","S1_SECRET","gUsername","git_username","gReponame","git_reponame","date","Date","CronJob","job","cronTime","onTick","post","then","data","console","log","catch","start","timeZone","listen"],"mappings":";;;;;;AAAA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,MAAM,wBAAZ;AACA,IAAMC,WAAWC,QAAQC,GAAR,CAAYC,IAAZ,IAAoB,IAArC;AACA,IAAMC,WAAWH,QAAQC,GAAR,CAAYE,QAAZ,IAAwB,WAAzC;;AAGAL,IAAIM,GAAJ,CAAQ,qBAAR;AACAN,IAAIM,GAAJ,CAAQ,sBAAO,KAAP,CAAR;AACAN,IAAIM,GAAJ,CAAQ,qBAAWC,IAAX,EAAR;AACAP,IAAIM,GAAJ,CAAQ,MAAR;AACAN,IAAIM,GAAJ,CAAQ,kBAAQE,MAAR,CAAe,eAAKC,IAAL,CAAUC,SAAV,EAAqB,YAArB,CAAf,CAAR;;AAEA;AACAV,IAAIW,GAAJ,CAAQ,eAAR,EAAyB,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AACzCA,QAAIC,SAAJ,CAAc,cAAd,EAA8B,kBAA9B;AACAD,QAAIE,IAAJ;AACH,CAHD;;AAKAf,IAAIW,GAAJ,CAAQ,GAAR,EAAa,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AAC7B,QAAMG,SAAS;AACXC,eAAOf,QAAQC,GAAR,CAAYc,KADR;AAEXC,kBAAUhB,QAAQC,GAAR,CAAYe,QAFX;AAGXC,kBAAUjB,QAAQC,GAAR,CAAYgB,QAHX;AAIXC,gBAAQlB,QAAQC,GAAR,CAAYkB,SAJT;AAKXC,mBAAWpB,QAAQC,GAAR,CAAYoB,YALZ;AAMXC,mBAAWtB,QAAQC,GAAR,CAAYsB,YANZ;AAOXC,cAAM,IAAIC,IAAJ;AAPK,KAAf;AASA,QAAIC,UAAU,eAAKA,OAAnB;AACA,QAAIC,MAAM,IAAID,OAAJ,CAAY;AAClBE,kBAAU,gBADQ,EACU;AAC5BC,gBAAQ,kBAAY;AAAA;;AAChB,4BAAMC,IAAN,CAAW,+CAAX,EACI;AACI,4BAAY,KAAKhB,MAAL,CAAYM,SAD5B;AAEI,4BAAY,KAAKN,MAAL,CAAYQ,SAF5B;AAGI,yBAAS,KAAKR,MAAL,CAAYI,MAHzB;AAII,wBAAQ,KAAKJ,MAAL,CAAYU;AAJxB,aADJ,EAOEO,IAPF,CAOO,UAACC,IAAD,EAAU;AACb,6CAAU,MAAKlB,MAAf,EAAuBkB,KAAKA,IAA5B,EAAkC,UAACA,IAAD,EAAU;AAAEC,4BAAQC,GAAR,CAAY,gBAAgBF,IAA5B;AAAoC,iBAAlF;AACH,aATD,EASGG,KATH,CASS,UAACH,IAAD,EAAU;AACf,6CAAU,MAAKlB,MAAf,EAAuBkB,IAAvB;AACH,aAXD;AAYH,SAfiB;AAgBlBI,eAAO,KAhBW;AAiBlBC,kBAAU;AAjBQ,KAAZ,CAAV;AAmBAV,QAAIb,MAAJ,GAAaA,MAAb;AACAa,QAAIS,KAAJ;;AAEAzB,QAAIE,IAAJ,CAAS,kHAAT;AAEH,CAnCD;AAoCAf,IAAIwC,MAAJ,CAAWvC,QAAX,EAAqB,YAAY;AAC7B,qBAAOmC,GAAP,CACI,MADJ,EAEI,uBAAuB/B,QAAvB,GAAkC,GAAlC,GAAwCJ,QAF5C;AAIH,CALD;;kBAOeD,G","file":"api.js","sourcesContent":["import 'babel-polyfill';\nimport cors from 'cors';\nimport path from 'path';\nimport routes from './routes';\nimport express from 'express';\nimport bodyParser from 'body-parser';\nimport cron from 'cron';\nimport { sendEmail } from './report/emailService';\nimport axios from 'axios';\nimport swaggerSpec from './utils/swagger';\nimport morgan from 'morgan';\nimport logger from './utils/logger';\n\nconst app = express();\nconst APP_PORT = process.env.PORT || 3000;\nconst APP_HOST = process.env.APP_HOST || 'localhost';\n\n\napp.use(cors());\napp.use(morgan('dev'));\napp.use(bodyParser.json());\napp.use('/api', routes);\napp.use(express.static(path.join(__dirname, '/../public')));\n\n// serve swagger\napp.get('/swagger.json', function (req, res) {\n    res.setHeader('Content-Type', 'application/json');\n    res.send(swaggerSpec);\n});\n\napp.get('/', function (req, res) {\n    const config = {\n        email: process.env.email,\n        password: process.env.password,\n        email_to: process.env.email_to,\n        gToken: process.env.S1_SECRET,\n        gUsername: process.env.git_username,\n        gReponame: process.env.git_reponame,\n        date: new Date()\n    }\n    let CronJob = cron.CronJob;\n    let job = new CronJob({\n        cronTime: '05 56 17 * * *', //Send Email at 5.30 every day\n        onTick: function () {\n            axios.post('https://psrgenerator.herokuapp.com/api/status',\n                {\n                    \"username\": this.config.gUsername,\n                    \"reponame\": this.config.gReponame,\n                    \"token\": this.config.gToken,\n                    \"date\": this.config.date\n                }\n            ).then((data) => {\n                sendEmail(this.config, data.data, (data) => { console.log(\"Email Sent \" + data); });\n            }).catch((data) => {\n                sendEmail(this.config, data);\n            });\n        },\n        start: false,\n        timeZone: 'Asia/Kathmandu'\n    });\n    job.config = config;\n    job.start();\n\n    res.send('<h1>Started...</h1><br><a href=\"https://psrgenerator.herokuapp.com/api-docs\" target=\"_blank\"> Documentation </a>');\n\n});\napp.listen(APP_PORT, function () {\n    logger.log(\n        'info',\n        'Server started at ' + APP_HOST + ':' + APP_PORT\n    );\n})\n\nexport default app;"]}